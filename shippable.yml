language: php
runtime:
branches:
    only:
    - Test_task
    build:
    
      pre_ci:
      - docker build -t v0.4 .

      pre_ci_boot:
        image_name: v0.4
        image_tag: latest
        pull: true
      ci:
        - apt update
        - nginx -t
        - service nginx status
        - service nginx restart
      post_ci:
        - docker commit $SHIPPABLE_CONTAINER_NAME kaloblok/v0.3:ci_test
        - docker push kaloblok/v0.3:ci_test
      on_success:
        - echo "CI was successfully completed"
      on_failure:
        - echo "CI was FAILED"
    
      integrations:
      hub:
        - integrationName: Docker-Hub-integration
          type: dockerRegistryLogin